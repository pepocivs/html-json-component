<!--
@license
Copyright (c) 2018 Jorge Martín Martí (@pepocivs). All rights reserved.
This code may only be used under the MIT style license found at https://raw.githubusercontent.com/pepocivs/html-json-component/master/LICENSE.txt
-->

<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="html-json-component">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <h2>JSON - HTML Printer</h2>
    <div id="printer"></div>
  </template>

  <script>
    /**
     * `html-json-component`
     * JSON beautifier component for polymer
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class HtmlJsonComponent extends (class extends Polymer.Element {}) {
      static get is() { return 'html-json-component'; }
      static get properties() {
        return {
          json: {
            type: Object,
            notify: true,
            observer: '_convertJSON'
          },
          print: {
            type: Boolean,
            value: true
          },
          equivalences: {
            type: Object,
            value: {}
          },
          table: Boolean,
          list: Boolean
        };
      }
      _convertJSON(json) {
        if (this.table) this.generateTableHTML(json);
        if (this.list) this.generateListHTML(json);
      }

      generateTableHTML(json) {
        let htmlCode = '<table>';
        this._print('table', htmlCode);
        return json;
      }

      generateListHTML(json) {
        let htmlCode = '<table>';
        this._print('list', this.jsonBeautifier(json, ''));
        return json;
      }

      _print(id, html) {
        if (!this.print) return false;
        const docPlace = this.$.printer;
        const containerHTML = document.createElement("div");
        containerHTML.id = id;
        containerHTML.innerHTML = html;
        docPlace.appendChild(containerHTML);
      }




      jsonBeautifier(json, parentKey) {
        let html = (parentKey && parentKey.length > 0) ? 
          `<ul><li><strong>${parentKey}:</strong> <ul>` : '<ul>';
        html += (json.length === undefined) ? 
          this.fillData(Object.keys(json), parentKey, html) : 
          this.fillData(json, parentKey, html);
        html += (parentKey && parentKey.length > 0) ? '</li></ul>' : '';
        return html;
      }
      fillData(json, parentKey, html) {
        html+= `</ul>${json.map(this._printRow, this).join()}`;
      }

      _printRow(objectKey, index, json) {
        let html = '';
        const key = this.equivalences[objectKey] || objectKey;
        const value = (objectKey.length > 0) ? json[index][objectKey] : json[index];
        switch (typeof value) {
          case 'object':
            html += this.jsonBeautifier(value, key);
            break;
          case 'boolean':
            const parsedValue = (value === true) ? 'Yes' : 'No';
            html += `<ul><li><strong>${key}: </strong> ${parsedValue}</li></ul>`;
            break;
          default:
            html += `<ul><li><strong>${key}: </strong> ${value}</li></ul>`;
            break;
        }
        return html;
      }
    }

    window.customElements.define(HtmlJsonComponent.is, HtmlJsonComponent);
  </script>
</dom-module>
