<!--
@license
Copyright (c) 2018 Jorge Martín Martí (@pepocivs). All rights reserved.
This code may only be used under the MIT style license found at https://raw.githubusercontent.com/pepocivs/html-json-component/master/LICENSE.txt
-->

<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="html-json-component">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <h2>JSON - HTML Printer</h2>
    <div id="printer"></div>
  </template>

  <script>
    /**
     * `html-json-component`
     * JSON beautifier component for polymer
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class HtmlJsonComponent extends (class extends Polymer.Element {}) {
      static get is() { return 'html-json-component'; }
      static get properties() {
        return {
          json: {
            type: Object,
            notify: true,
            observer: '_convertJSON'
          },
          print: {
            type: Boolean,
            value: true
          },
          equivalences: {
            type: Object,
            value: {}
          },
          output: String
        };
      }
      _convertJSON(json) {
        this._print(this.jsonBeautifier(json, ''));
      }

      _print(html) {
        if (!this.print) return false;
        const docPlace = this.$.printer;
        const containerHTML = document.createElement("div");
        containerHTML.innerHTML = html;
        docPlace.appendChild(containerHTML);
      }

      jsonBeautifier(json, parentKey) {
        let html = (parentKey && parentKey.length > 0) ?
          `<ul><li><strong>${parentKey}:</strong> <ul>` : '<ul>';
        html += (json.length === undefined) ?
          this._fillData(Object.keys(json), html, json) :
          this._fillData(json, html);
        html += (parentKey && parentKey.length > 0) ? '</li></ul>' : '</ul>';       
        return html;
      }
      _fillData(json, html, currentJson) {
        this.currentJson = currentJson || json;
        return `${html}</ul>${json.map(this._printRow, this).join('')}`;
      }
      _printRow(objectKey, index) {
        let html = '';
        if (typeof objectKey === 'object') html += this.jsonBeautifier(objectKey, index);
        else {
          const key = this.equivalences[objectKey] || objectKey;
          const value = (this.currentJson[index] && this.currentJson[index].length) ? this.currentJson[index] : this.currentJson[objectKey];
          switch (typeof value) {
            case 'object':
              html += this.jsonBeautifier(value, key);
              break;
            case 'boolean':
              const parsedValue = (value === true) ? 'Yes' : 'No';
              html += `<ul><li><strong>${key}: </strong> ${parsedValue}</li></ul>`;
              break;
            default:
              html += `<ul><li><strong>${key}: </strong> ${value}</li></ul>`;
              break;
          }
        }
        return html;
      }
    }

    window.customElements.define(HtmlJsonComponent.is, HtmlJsonComponent);
  </script>
</dom-module>
